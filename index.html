<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moo Deng Coin</title>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
header { background: #2c3e50; color: white; padding: 20px; text-align: center; }
.container { max-width: 500px; margin: 30px auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
button { padding: 10px 15px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; background: #27ae60; color: white; font-weight: bold; }
input { padding: 10px; width: 95%; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; }
h2, h3 { margin-top: 0; }
.referral-section { background: #ecf0f1; padding: 10px; border-radius: 5px; margin-top: 15px; }
</style>
</head>
<body>

<header>
<h1>Moo Deng Coin</h1>
</header>

<div class="container" id="auth-container">
<h2>Login / Signup</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button id="login-btn">Login</button>
<button id="signup-btn">Signup</button>
<p id="auth-msg" style="color:red;"></p>
</div>

<div class="container" id="wallet-container" style="display:none;">
<h2>Wallet</h2>
<p>Balance: <span id="balance">0</span> tokens</p>
<button id="mine-btn">Mine Token</button>
<p id="mine-msg" style="color:green;"></p>

<div class="referral-section">
<h3>Your Referral</h3>
<p>Your Referral Code: <span id="ref-code"></span></p>
<p>Share this link: <span id="ref-link"></span></p>
</div>

<button id="logout-btn" style="background:#c0392b;">Logout</button>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBRitTsyqXfk6XNh3t1j0boebQa1LNQkKs",
  authDomain: "moo-deng-coin.firebaseapp.com",
  projectId: "moo-deng-coin",
  storageBucket: "moo-deng-coin.appspot.com",
  messagingSenderId: "629636349388",
  appId: "1:629636349388:web:a9a7924aaea9354a09f169"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// DOM Elements
const authContainer = document.getElementById('auth-container');
const walletContainer = document.getElementById('wallet-container');
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const loginBtn = document.getElementById('login-btn');
const signupBtn = document.getElementById('signup-btn');
const logoutBtn = document.getElementById('logout-btn');
const balanceEl = document.getElementById('balance');
const mineBtn = document.getElementById('mine-btn');
const mineMsg = document.getElementById('mine-msg');
const refCodeEl = document.getElementById('ref-code');
const refLinkEl = document.getElementById('ref-link');
const authMsg = document.getElementById('auth-msg');

// Helper: Generate Referral Code
function generateRefCode() {
  return Math.random().toString(36).substring(2,10);
}

// Signup
signupBtn.addEventListener('click', async ()=>{
  const email = emailInput.value;
  const password = passwordInput.value;
  if(!email || !password){ authMsg.textContent = "Please enter email & password"; return;}
  try{
    const userCredential = await createUserWithEmailAndPassword(auth,email,password);
    const user = userCredential.user;
    const refCode = generateRefCode();
    await setDoc(doc(db,'users',user.uid),{
      balance:0,
      mines:0,
      referrals:0,
      refCode: refCode
    });
  } catch(err){ authMsg.textContent = err.message; }
});

// Login
loginBtn.addEventListener('click', async ()=>{
  const email = emailInput.value;
  const password = passwordInput.value;
  if(!email || !password){ authMsg.textContent = "Please enter email & password"; return;}
  try{
    await signInWithEmailAndPassword(auth,email,password);
  } catch(err){ authMsg.textContent = err.message; }
});

// Logout
logoutBtn.addEventListener('click', ()=>{
  signOut(auth);
});

// Auth State
onAuthStateChanged(auth, async (user)=>{
  if(user){
    authContainer.style.display = 'none';
    walletContainer.style.display = 'block';
    const docRef = doc(db,'users',user.uid);
    const docSnap = await getDoc(docRef);
    if(docSnap.exists()){
      const data = docSnap.data();
      balanceEl.textContent = data.balance;
      refCodeEl.textContent = data.refCode;
      refLinkEl.textContent = window.location.href + "?ref=" + data.refCode;
    }
  } else{
    authContainer.style.display = 'block';
    walletContainer.style.display = 'none';
    authMsg.textContent = '';
    emailInput.value = '';
    passwordInput.value = '';
  }
});

// Mining
mineBtn.addEventListener('click', async ()=>{
  const user = auth.currentUser;
  if(!user) return;
  const docRef = doc(db,'users',user.uid);
  const docSnap = await getDoc(docRef);
  if(docSnap.exists()){
    const data = docSnap.data();
    const minedTokens = 10;
    const newBalance = data.balance + minedTokens;
    const newMines = data.mines + 1;
    await updateDoc(docRef,{
      balance: newBalance,
      mines: newMines
    });
    balanceEl.textContent = newBalance;
    mineMsg.textContent = `Successfully mined ${minedTokens} tokens!`;
    setTimeout(()=>{mineMsg.textContent='';},3000);
  }
});
</script>

</body>
</html>
