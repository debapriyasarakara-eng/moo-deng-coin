<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Moo Deng Coin</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#FFD700">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
body{background:#0d0d0d;color:#fff;display:flex;justify-content:center;min-height:100vh;padding:20px;}

.container{max-width:450px;width:100%;background:#111;padding:20px;border-radius:10px;box-shadow:0 0 20px rgba(0,255,221,0.3);}
h1,h2,h3{margin-bottom:10px;}

/* Header */
.app-header{display:flex;align-items:center;justify-content:space-between;}
h1{font-family:'Cinzel Decorative',serif;font-size:26px;font-weight:bold;
    background:linear-gradient(90deg,#FFD700,#FFA500);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    animation:glow 2s infinite alternate;display:flex;align-items:center;gap:8px;}
@keyframes glow{from{text-shadow:0 0 5px #FFD700;}to{text-shadow:0 0 20px #FFA500;}}
.coin-symbol{width:50px;aspect-ratio:1/1;border-radius:50%;
    background:radial-gradient(circle,#FFD700 10%,#FFA500 70%,#b8860b 100%);
    display:inline-flex;align-items:center;justify-content:center;
    font-size:24px;color:#fff;font-weight:bold;margin-left:6px;
    animation:coinPulse 2s infinite;
    box-shadow:0 0 15px rgba(255,215,0,0.9), inset 0 0 6px #fff;}
@keyframes coinPulse{0%{transform:scale(1);}50%{transform:scale(1.15);}100%{transform:scale(1);}}
.logout-btn{background:#ff4444;color:#fff;padding:8px 14px;border:none;border-radius:5px;cursor:pointer;}

/* Wallet */
.wallet,.referral,.tabs,.tab-content{margin-top:20px;}
.wallet span,.referral span{font-weight:bold;color:#00ffdd;}

/* Mining Circle */
.mining-container{position:relative;width:220px;margin:20px auto;}
.circle{
  width:100%;aspect-ratio:1/1;border-radius:50%;
  background:url('./coin.png') no-repeat center/cover,
             radial-gradient(circle at 30% 30%, #fff8b0 0%, #FFD700 30%, #FFA500 70%, #7a4a00 100%);
  display:flex;justify-content:center;align-items:center;
  font-size:22px;font-weight:bold;color:#000;
  text-shadow:0 0 4px #fff,0 0 2px #000;
  box-shadow: inset -3px -3px 8px rgba(0,0,0,0.6),
              inset 3px 3px 6px rgba(255,255,255,0.6),
              0 0 20px rgba(255,215,0,0.6);
}

/* Mine Button */
#mineBtn{display:block;margin:20px auto;padding:15px 25px;font-size:18px;font-weight:bold;
  background:linear-gradient(90deg,#FFD700,#FFA500);border:none;border-radius:50px;color:#111;
  box-shadow:0 4px 10px rgba(255,215,0,0.5);cursor:pointer;}
#mineBtn:hover{background:linear-gradient(90deg,#FFA500,#FFD700);transform:scale(1.05);}

/* Tabs */
.tabs{display:flex;justify-content:space-around;}
.tabs button{flex:1;margin:0 5px;padding:10px;background:#00ffdd;border:none;border-radius:5px;cursor:pointer;color:#000;font-weight:bold;}
.tab-content{display:none;margin-top:20px;background:#111;padding:15px;border-radius:10px;}
.tab-content.active{display:block;}
</style>
</head>
<body>

<!-- Auth -->
<div class="container" id="authContainer">
  <h2>Sign In</h2>
  <button id="googleSignInBtn">Sign in with Google</button>
</div>

<!-- Main UI -->
<div class="container" id="mainContainer" style="display:none;">
  <div class="app-header">
    <h1>Moo Deng COIN <span class="coin-symbol">ðŸ¦›</span></h1>
    <button id="logoutBtn" class="logout-btn">Logout</button>
  </div>

  <!-- Wallet -->
  <div class="wallet">
    <h2>Wallet</h2>
    <p>MDC Balance: <span id="balance">0</span></p>
    <button id="mineBtn">Mine Token</button>
  </div>

  <!-- Mining Circle -->
  <div class="mining-container">
    <div class="circle"><span id="timerText">00:00:00</span></div>
  </div>

  <!-- Referral -->
  <div class="referral">
    <h3>Your Referral</h3>
    <p>Code: <span id="refCode"></span></p>
    <p>Referred Users: <span id="refCount">0</span></p>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button data-tab="historyTab">History</button>
    <button data-tab="whitepaperTab">White Paper</button>
  </div>
  <div class="tab-content" id="historyTab"><h3>Mining History</h3><ul id="historyList"></ul></div>
  <div class="tab-content" id="whitepaperTab"><h3>White Paper</h3><p>Coming soon...</p></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion, runTransaction } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

const firebaseConfig={apiKey:"AIza..",authDomain:"...",projectId:"..."};
const app=initializeApp(firebaseConfig);const auth=getAuth(app);const db=getFirestore(app);

const authContainer=document.getElementById('authContainer'),mainContainer=document.getElementById('mainContainer');
const googleSignInBtn=document.getElementById('googleSignInBtn'),logoutBtn=document.getElementById('logoutBtn');
const balanceEl=document.getElementById('balance'),mineBtn=document.getElementById('mineBtn'),timerText=document.getElementById('timerText');
const refCodeEl=document.getElementById('refCode'),refCountEl=document.getElementById('refCount'),historyList=document.getElementById('historyList');
const tabs=document.querySelectorAll('.tabs button'),tabContents=document.querySelectorAll('.tab-content');

let userDocRef=null,userData={balance:0,mines:0,lastMine:0,history:[],referrals:0,referredBy:null,signupTime:0};
const MINE_INTERVAL=2*60*60*1000,MAX_DAILY_MINES=5;

// Referral Bonus function
async function applyReferralBonus(refUid){
  const refUserRef=doc(db,"users",refUid);
  try{await runTransaction(db,async(t)=>{const refUserDoc=await t.get(refUserRef);
    if(!refUserDoc.exists())return;
    const d=refUserDoc.data();
    t.update(refUserRef,{balance:(d.balance||0)+50,referrals:(d.referrals||0)+1});
  });}catch(e){console.error(e);}
}

// Google Auth
googleSignInBtn.addEventListener("click",async()=>{await signInWithPopup(auth,new GoogleAuthProvider());});
logoutBtn.addEventListener("click",()=>signOut(auth));
onAuthStateChanged(auth,async(u)=>{
  if(u){
    authContainer.style.display="none";mainContainer.style.display="block";
    userDocRef=doc(db,"users",u.uid);
    const snap=await getDoc(userDocRef);
    let referredBy=new URLSearchParams(window.location.search).get("ref");
    if(!snap.exists()){
      await setDoc(userDocRef,{balance:0,mines:0,lastMine:0,history:[],referrals:0,refCode:u.uid,referredBy:referredBy||null,signupTime:Date.now()});
      if(referredBy)await applyReferralBonus(referredBy);
    }
    loadUser(u.uid);
  }else{authContainer.style.display="block";mainContainer.style.display="none";}
});

// Load user
async function loadUser(uid){
  const snap=await getDoc(doc(db,"users",uid));
  if(snap.exists()){
    userData=snap.data();
    balanceEl.textContent=userData.balance||0;
    refCodeEl.textContent=userData.refCode||uid;
    refCountEl.textContent=userData.referrals||0;
    renderHistory();
    updateMiningTimer();
  }
}
function renderHistory(){historyList.innerHTML="";(userData.history||[]).slice().reverse().forEach(i=>{historyList.innerHTML+=`<li>Mined ${i.amount} MDC at ${new Date(i.timestamp).toLocaleString()}</li>`;});}
function updateMiningTimer(){
  const now=Date.now();let remain=userData.lastMine+MINE_INTERVAL-now;
  if(remain<=0||userData.mines>=MAX_DAILY_MINES){timerText.textContent="Ready";mineBtn.disabled=false;}
  else{mineBtn.disabled=true;let h=Math.floor(remain/3600000),m=Math.floor((remain%3600000)/60000),s=Math.floor((remain%60000)/1000);
    timerText.textContent=`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;requestAnimationFrame(updateMiningTimer);}
}

// Mining
mineBtn.addEventListener("click",async()=>{
  if(userData.mines>=MAX_DAILY_MINES){alert("Daily mining limit reached!");return;}
  userData.balance+=10;userData.mines+=1;userData.lastMine=Date.now();
  const newHist={amount:10,timestamp:Date.now()};
  await updateDoc(userDocRef,{balance:userData.balance,mines:userData.mines,lastMine:userData.lastMine,history:arrayUnion(newHist)});
  if(userData.referredBy&&(Date.now()-userData.signupTime<=7*24*60*60*1000)){
    const refUserRef=doc(db,"users",userData.referredBy);const refSnap=await getDoc(refUserRef);
    if(refSnap.exists()){await updateDoc(refUserRef,{balance:(refSnap.data().balance||0)+0.2});}}
  balanceEl.textContent=userData.balance;userData.history.push(newHist);renderHistory();updateMiningTimer();
});

// Tabs
tabs.forEach(tab=>{tab.addEventListener("click",()=>{tabContents.forEach(tc=>tc.classList.remove("active"));document.getElementById(tab.dataset.tab).classList.add("active");});});
</script>
</body>
</html>
