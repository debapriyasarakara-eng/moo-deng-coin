<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Moo Deng Coin</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet" />
<meta name="theme-color" content="#FFD700" />
<link rel="manifest" href="manifest.json" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  * {margin:0; padding:0; box-sizing:border-box; font-family: Arial, sans-serif;}
  body {
    background: #0d0d0d; color: #fff;
    display: flex; justify-content: center;
    min-height: 100vh; padding: 20px;
  }
  .container {
    max-width: 450px; width: 100%;
    background: #111; padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0, 255, 221, 0.3);
  }
  h1, h2, h3 {margin-bottom: 10px;}
  .app-header {
    display: flex; align-items: center; justify-content: space-between;
  }
  h1 {
    font-family: 'Cinzel Decorative', serif;
    font-weight: bold; font-size: 26px;
    background: linear-gradient(90deg, #FFD700, #FFA500);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: glow 2s infinite alternate;
    display: flex; align-items: center; gap: 8px;
    flex-wrap: wrap;
  }
  @keyframes glow {
    from {text-shadow: 0 0 5px #FFD700;}
    to {text-shadow: 0 0 20px #FFA500;}
  }
  .coin-symbol {
    width: 50px; aspect-ratio: 1/1; border-radius: 50%;
    background: radial-gradient(circle, #FFD700 10%, #FFA500 70%, #b8860b 100%);
    display: inline-flex; align-items: center; justify-content: center;
    font-size: 24px; color: #fff; font-weight: bold;
    margin-left: 6px;
    animation: coinPulse 2s infinite;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.9),
      inset 0 0 6px #fff;
  }
  @keyframes coinPulse {
    0% {transform: scale(1);}
    50% {transform: scale(1.15);}
    100% {transform: scale(1);}
  }
  .logout-btn {
    background: #ff4444; color: #fff; padding: 8px 14px;
    border: none; border-radius: 5px; cursor: pointer;
  }
  #authContainer {
    display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 300px; text-align: center;
  }
  #googleSignInBtn {
    background: #fff; border: none; padding: 12px 20px;
    border-radius: 8px; font-size: 16px; font-weight: bold;
    cursor: pointer; display: flex; align-items: center;
    gap: 8px; color: #000; margin-top: 20px;
  }
  #googleSignInBtn i {
    font-size: 20px;
  }
  .install-instructions {
    margin-top: 20px; font-size: 14px; line-height: 1.6; color: #ccc; text-align: center;
  }
  .install-instructions h3 {
    color: #FFD700; margin-bottom: 10px;
  }
  .wallet, .referral, .tabs, .tab-content {
    margin-top: 20px;
  }
  .wallet span, .referral span {
    font-weight: bold; color: #00ffdd;
  }
  .mining-container {
    position: relative; width: 220px; margin: 20px auto;
  }
  .circle {
    width: 100%; aspect-ratio: 1/1; border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #fff8b0 0%, #FFD700 30%, #FFA500 70%, #7a4a00 100%);
    display: flex; justify-content: center; align-items: center;
    font-size: 22px; font-weight: bold;
    color: #000;
    text-shadow: 0 0 4px #fff, 0 0 2px #000;
    box-shadow:
      inset -3px -3px 8px rgba(0,0,0,0.6),
      inset 3px 3px 6px rgba(255,255,255,0.6),
      0 0 20px rgba(255,215,0,0.6);
  }
  #mineBtn {
    display: block; margin: 20px auto; padding: 15px 25px;
    font-size: 18px; font-weight: bold;
    background: linear-gradient(90deg, #FFD700, #FFA500);
    border: none; border-radius: 50px;
    color: #111;
    box-shadow: 0 4px 10px rgba(255,215,0,0.5);
    cursor: pointer;
    transition: 0.3s;
  }
  #mineBtn:hover {
    background: linear-gradient(90deg, #FFA500, #FFD700);
    transform: scale(1.05);
  }
  .nav-btn {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
    margin-top: 20px;
  }
  #walletBtn, #telegramBtn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 15px 25px;
    font-size: 18px;
    font-weight: bold;
    border: none;
    border-radius: 50px;
    color: #111;
    box-shadow: 0 4px 10px rgba(0, 255, 221, 0.5);
    cursor: pointer;
    transition: 0.3s;
  }
  #walletBtn {
    background: linear-gradient(90deg, #00ffdd, #00ddff);
  }
  #walletBtn:hover {
    background: linear-gradient(90deg, #00ddff, #00ffdd);
    transform: scale(1.05);
  }
  #telegramBtn {
    background: #0088CC;
    color: #fff;
    box-shadow: 0 4px 10px rgba(0, 136, 204, 0.5);
    text-decoration: none;
  }
  #telegramBtn:hover {
    background: #0077B3;
    transform: scale(1.05);
  }
  .tabs {
    display: flex; justify-content: space-around;
  }
  .tabs button {
    flex: 1; margin: 0 5px; padding: 10px;
    background: #00ffdd;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    color: #000;
    font-weight: bold;
  }
  .tab-content {
    display: none; margin-top: 20px; background: #111;
    padding: 15px; border-radius: 10px;
    max-height: 500px;
    overflow-y: auto;
  }
  .tab-content.active {
    display: block;
  }
  .referral input.copy-input {
    flex: 1; padding: 6px 10px; border: none; border-radius: 5px;
    background: #222; color: #0ff; font-weight: bold; font-size: 14px;
    user-select: all;
  }
  .referral .copy-btn {
    background: #00ffdd; border: none; border-radius: 5px;
    padding: 5px 12px; cursor: pointer; font-weight: bold;
    color: #000; margin-left: 8px;
  }
  .game-section {
    margin-top: 30px; text-align: center;
  }
  .boxes {
    display: flex; justify-content: center; gap: 15px; margin: 20px 0;
  }
  .boxes .box {
    width: 70px; height: 70px;
    background: linear-gradient(135deg, #ffd700, #ffa500);
    color: #fff; font-size: 28px; font-weight: bold;
    border-radius: 15px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    box-shadow:
      0 4px 8px rgba(255, 165, 0, 0.6),
      inset 0 0 10px rgba(255, 255, 255, 0.3);
    border: 2px solid #fff5a1;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    user-select: none; user-drag: none;
  }
  .boxes .box:hover {
    background: linear-gradient(135deg, #fff700, #ffb700);
    box-shadow:
      0 6px 12px rgba(255, 215, 0, 0.8),
      inset 0 0 14px rgba(255, 255, 255, 0.6);
    transform: scale(1.1);
  }
  #gameResult {
    color: #0ff; font-weight: bold;
  }
  #claimBtn {
    display: none; background: #00ffdd; border: none; border-radius: 5px;
    padding: 10px 20px; cursor: pointer; color: #000;
  }
  #referralRuleMsg {
    margin-top: 15px;
    background: #222;
    border: 2px solid #00ffdd;
    border-radius: 5px;
    padding: 10px;
    font-size: 14px;
    color: #00ffdd;
    font-weight: bold;
    text-align: center;
  }

  .ad-container {
    margin: 15px 0;
    display: flex;
    justify-content: center;
    width: 100%;
  }
</style>
</head>
<body>

<div class="container" id="authContainer">
  <div class="ad-container">
    <script type="text/javascript">
      atOptions = { 
        'key' : '56c7e68cb187e2bbd1d7a071ebc374e0', 
        'format' : 'iframe', 
        'height' : 50, 
        'width' : 320, 
        'params' : {} 
      };
    </script>
    <script type="text/javascript" src="//www.topcreativeformat.com/56c7e68cb187e2bbd1d7a071ebc374e0/invoke.js"></script>
  </div>
  
  <h2>Sign In</h2>
  <button id="googleSignInBtn"><i class="fab fa-google"></i> Sign in with Google</button>
  
  <div class="install-instructions">
    <h3>Install MDC</h3>
    <p>1. Tap on the ‚ãÆ menu in your browser's right corner.</p>
    <p>2. Scroll down and select "Add to Home Screen".</p>
    <p>3. Open MDC from your Home Screen!</p>
    <p>4. Keep this tab open to keep mining active.</p>
  </div>
  
  <div class="ad-container">
    <script type="text/javascript">
      atOptions = { 
        'key' : '077874450aaa530a8c84fbc3c2275129', 
        'format' : 'iframe', 
        'height' : 250, 
        'width' : 300, 
        'params' : {} 
      };
    </script>
    <script type="text/javascript" src="//www.topcreativeformat.com/077874450aaa530a8c84fbc3c2275129/invoke.js"></script>
  </div>
  
  <div class="ad-container">
    <script type="text/javascript">
      atOptions = {
        'key' : 'adf446e9803ea369c6ceb9816deb5be0',
        'format' : 'iframe',
        'height' : 600,
        'width' : 300,
        'params' : {}
      };
    </script>
    <script type="text/javascript" src="//notioncarpplash.com/adf446e9803ea369c6ceb9816deb5be0/invoke.js"></script>
  </div>
</div>

<div class="container" id="mainContainer" style="display:none;">
  <div class="app-header">
    <h1>Moo Deng COIN <span class="coin-symbol">ü¶õ</span></h1>
    <button id="logoutBtn" class="logout-btn">Logout</button>
  </div>
  
  <div class="wallet">
    <h2></h2>
  </div>

  <div class="nav-btn">
    <button id="walletBtn">Open Wallet</button>
    <a href="https://t.me/newMooDengCoin" id="telegramBtn" target="_blank">
        <i class="fab fa-telegram-plane"></i> Join Our Official Telegram Channel
    </a>
  </div>

  <div class="mining-container">
    <div class="circle"><span id="timerText">00:00:00</span></div>
  </div>

  <div class="wallet">
    <button id="mineBtn">Mine Token</button>
  </div>

  <div class="referral">
    <h3>Your Referral</h3>
    <p>Code: <span id="refCode"></span></p>
    <div style="display:flex; gap:8px; margin-top: 10px;">
      <input class="copy-input" id="refLink" readonly />
      <button class="copy-btn" id="copyBtn">Copy</button>
    </div>
    <div id="referralRuleMsg">
      Referral commission is available only if you refer at least <span id="minReferralCount">10</span> users.<br />
      If you do not reach this minimum,You will not be able to use the airdrop balance if you do not meet the conditions. the MDC airdrop will be disabled for you.
    </div>
  </div>

  <div class="tabs">
    <button data-tab="historyTab" class="active">History</button>
    <button data-tab="whitepaperTab">White Paper</button>
  </div>

  <div class="tab-content active" id="historyTab">
    <h3>Mining History</h3>
    <ul id="historyList"></ul>
  </div>

  <div class="tab-content" id="whitepaperTab">
    <div style="color:#fff; font-family: Arial, sans-serif; line-height: 1.6; max-height: 500px; overflow-y: auto; padding: 15px;">
      <h1>White Paper</h1>
      <h2>Moo Deng Coin (MDC)</h2>
      <p><strong>Version 1.0</strong><br/>
      <strong>Author:</strong> Moo Deng Labs<br/>
      <strong>Contact:</strong> info@moodengcoin.com</p>
      <hr style="border-color: #444; margin: 15px 0;" />
      <h3>Abstract</h3>
      <p><strong>Moo Deng Coin (MDC)</strong> is a <strong>mobile-first digital token</strong> designed for ease of mining and user engagement. Unlike traditional blockchain-based cryptocurrencies, MDC operates via a token-driven gaming and economic system, powered by modern web technologies and Firebase backend for authentication and data management. Users can mine MDC at fixed intervals and quantities, with additional token rewards available through a <strong>robust referral system</strong>. This white paper outlines the platform‚Äôs core features, tokenomics, and roadmap.</p>
      <h3>Launch & Market Price Mechanism</h3>
      <p>Our platform is <strong>set to launch imminently</strong>, with no rigid exam or test date. The <strong>value of MDC will be entirely market-driven</strong>, fluctuating based on demand and supply dynamics within the ecosystem. Users are free to mine tokens subject to time-based restrictions designed to ensure fair distribution and sustainable growth.</p>
      <h3>Key Features</h3>
      <ul>
        <li><strong>Google Authentication:</strong> Secure and seamless login with Google accounts.</li>
        <li><strong>Mining System:</strong> Users can mine a fixed amount (10 MDC) every 2 hours, with a live timer displayed.</li>
        <li><strong>Referral Program:</strong>
          <ul>
            <li>Referrers receive a <strong>one-time 50 MDC bonus</strong> when new users sign up with their referral link.</li>
            <li>Referrers also earn a <strong>2% commission on mining rewards</strong> mined by their referees for the first 7 days after signup.</li>
          </ul>
        </li>
        <li><strong>Real-Time Wallet Updates:</strong> Direct addition of mined tokens to users‚Äô wallets, with upcoming withdrawal functionality.</li>
        <li><strong>Daily Lucky Box Game:</strong> Users can play once daily to win between 1 to 50 MDC tokens.</li>
        <li><strong>User-Friendly Wallet Interface:</strong> Fast display of balances and transaction history on the platform.</li>
        <li><strong>Security & Transparency:</strong> All transactions and user data securely stored and encrypted in Firebase Firestore.</li>
      </ul>
      <h3>Tokenomics</h3>
      <p>MDC is a <strong>utility token</strong> intended for use within the platform‚Äôs ecosystem. Token supply and distribution are designed to be balanced by mining activities and market interactions, ensuring long-term sustainability and user incentives.</p>
      <h3>Roadmap</h3>
      <ul>
        <li><strong>Q4 2025:</strong> Platform launch, including mining and referral features.</li>
        <li><strong>Q1 2026:</strong> Introduction of staking, futures trading, and launchpad features.</li>
        <li><strong>Q2 2026:</strong> Mobile app release and integration with external wallets.</li>
        <li><strong>Beyond:</strong> Adding real-world utility and expanding ecosystem adoption.</li>
      </ul>
      <h3>Important Notice</h3>
      <p><strong>Tokens mined by users will be credited directly to their wallets.</strong> This ensures immediate availability and transparency. To further enhance usability, <strong>withdrawal options will be introduced soon,</strong> enabling users to transfer their tokens with ease and security.</p>
      <h3>Conclusion</h3>
      <p>Moo Deng Coin aims to <strong>revolutionize mobile crypto mining and trading</strong> by merging gamified token economics with accessible technology. We invite users, investors, and partners to join us as we build a secure, engaging, and profitable crypto ecosystem.</p>
    </div>
  </div>

  <div class="game-section">
    <h3>üéÅ MDC Airdrop üéÅ</h3>
    <p>You can play once every 24 hours. Pick a box and win 1‚Äì50 MDC randomly!</p>
    <div class="boxes">
      <div class="box" data-index="1">?</div>
      <div class="box" data-index="2">?</div>
      <div class="box" data-index="3">?</div>
      <div class="box" data-index="4">?</div>
      <div class="box" data-index="5">?</div>
    </div>
    <p id="gameResult"></p>
    <button id="claimBtn">Claim Coins</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, runTransaction } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBRitTsyqXfk6XNh3t1j0boebQa1LNQkKs",
    authDomain: "moo-deng-coin.firebaseapp.com",
    projectId: "moo-deng-coin",
    storageBucket: "moo-deng-coin.appspot.com",
    messagingSenderId: "629636349388",
    appId: "1:629636349388:web:a9a7924aaea9354a09f169",
    measurementId: "G-T7FVX8DW2Z"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const authContainer = document.getElementById("authContainer");
  const mainContainer = document.getElementById("mainContainer");
  const googleSignInBtn = document.getElementById("googleSignInBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const walletBtn = document.getElementById("walletBtn");
  const mineBtn = document.getElementById("mineBtn");
  const timerText = document.getElementById("timerText");
  const refCodeEl = document.getElementById("refCode");
  const historyList = document.getElementById("historyList");
  const tabs = document.querySelectorAll(".tabs button");
  const tabContents = document.querySelectorAll(".tab-content");
  const refLink = document.getElementById("refLink");
  const copyBtn = document.getElementById("copyBtn");
  const gameResult = document.getElementById("gameResult");
  const claimBtn = document.getElementById("claimBtn");
  const boxes = document.querySelectorAll(".boxes .box");
  const referralRuleMsg = document.getElementById("referralRuleMsg");
  const minReferralCount = 10;

  let userDocRef = null;
  let userData = {
    balance: 0,
    lastMine: 0,
    history: [],
    referrals: 0,
    referredBy: null,
    signupTime: 0,
    lastGame: 0
  };
  const MINE_INTERVAL = 2 * 60 * 60 * 1000; // 2 hours
  const COMMISSION_PERIOD = 7 * 24 * 60 * 60 * 1000; // 7 days

  let miningTimerInterval = null;
  function updateMiningTimer() {
    if (miningTimerInterval) clearInterval(miningTimerInterval);
    miningTimerInterval = setInterval(() => {
      const now = Date.now();
      const elapsed = now - (userData.lastMine || 0);
      let timeLeft = MINE_INTERVAL - elapsed;
      if (timeLeft < 0) {
        timeLeft = 0;
        clearInterval(miningTimerInterval);
        miningTimerInterval = null;
      }
      const hours = Math.floor(timeLeft / (1000 * 60 * 60));
      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
      timerText.textContent = `${String(hours).padStart(2, "0")}:${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
    }, 1000);
  }

  async function applyReferralBonus(refUid) {
    if (!refUid) return;
    const refUserRef = doc(db, "walletUsers", refUid);
    try {
      await runTransaction(db, async (t) => {
        const refUserDoc = await t.get(refUserRef);
        if (!refUserDoc.exists()) return;
        const d = refUserDoc.data();
        const newBalance = (d.balance || 0) + 50;
        const newRefCount = (d.referrals || 0) + 1;
        t.update(refUserRef, {
          balance: newBalance,
          referrals: newRefCount,
        });
      });
    } catch (e) {
      console.error("Referral bonus transaction error:", e);
    }
  }

  async function applyReferralCommission(amount) {
    if (!userData.referredBy) return;
    const now = Date.now();
    if (now - userData.signupTime > COMMISSION_PERIOD) return;
    const refUserRef = doc(db, "walletUsers", userData.referredBy);
    try {
      await runTransaction(db, async (t) => {
        const refUserDoc = await t.get(refUserRef);
        if (!refUserDoc.exists()) return;
        const d = refUserDoc.data();
        const commissionAmount = Math.floor(amount * 0.02);
        if (commissionAmount <= 0) return;
        t.update(refUserRef, {
          balance: (d.balance || 0) + commissionAmount,
        });
      });
    } catch (e) {
      console.error("Referral commission error:", e);
    }
  }

  googleSignInBtn.addEventListener("click", async () => {
    googleSignInBtn.disabled = true;
    try {
      const result = await signInWithPopup(auth, new GoogleAuthProvider());
      const user = result.user;
      userDocRef = doc(db, "walletUsers", user.uid);
      const snapshot = await getDoc(userDocRef);
      let refCodeFromURL = new URLSearchParams(window.location.search).get("ref") || null;
      if (!snapshot.exists()) {
        await setDoc(userDocRef, {
          name: user.displayName || "",
          email: user.email,
          balance: 0,
          lastMine: 0,
          referrals: 0,
          history: [],
          refCode: user.uid,
          referredBy: refCodeFromURL,
          signupTime: Date.now(),
          lastGame: 0
        });
        if (refCodeFromURL) await applyReferralBonus(refCodeFromURL);
      }
      await loadUser(user.uid);
      afterLoginUI();
    } catch (error) {
      alert("Google Sign In Error: " + error.message);
    } finally {
      googleSignInBtn.disabled = false;
    }
  });

  logoutBtn.addEventListener("click", async () => {
    await signOut(auth);
    resetUI();
  });

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      userDocRef = doc(db, "walletUsers", user.uid);
      const docSnap = await getDoc(userDocRef);
      if (docSnap.exists()) {
        userData = docSnap.data();
        await loadUser(user.uid);
        afterLoginUI();
      } else {
        resetUI();
      }
    } else {
      resetUI();
    }
  });

  async function loadUser(uid) {
    const snap = await getDoc(doc(db, "walletUsers", uid));
    if (snap.exists()) {
      userData = snap.data();
      refCodeEl.textContent = userData.refCode || uid;
      refLink.value = window.location.href.split('?')[0] + "?ref=" + (userData.refCode || userDocRef.id);
      renderHistory();
      updateMiningTimer();

      if ((userData.referrals || 0) < minReferralCount) {
        referralRuleMsg.style.display = "block";
        disableLuckyBox();
      } else {
        referralRuleMsg.style.display = "none";
        enableLuckyBox();
      }
    }
  }

  function disableLuckyBox() {
    claimBtn.style.display = "none";
    boxes.forEach(box => {
      box.style.pointerEvents = "none";
      box.style.opacity = "0.4";
    });
    gameResult.textContent = "Lucky box airdrop is disabled until you refer at least 10 users.";
  }

  function enableLuckyBox() {
    boxes.forEach(box => {
      box.style.pointerEvents = "auto";
      box.style.opacity = "1";
    });
    gameResult.textContent = "";
  }

  function renderHistory() {
    historyList.innerHTML = "";
    (userData.history || []).slice().reverse().forEach(item => {
      const li = document.createElement("li");
      li.textContent = `Mined ${item.amount} MDC on ${new Date(item.time).toLocaleString()}`;
      historyList.appendChild(li);
    });
  }

  function afterLoginUI() {
    authContainer.style.display = "none";
    mainContainer.style.display = "block";
  }

  function resetUI() {
    authContainer.style.display = "flex";
    mainContainer.style.display = "none";
    refCodeEl.textContent = "";
    historyList.innerHTML = "";
    referralRuleMsg.style.display = "block";
    disableLuckyBox();
  }

  walletBtn.addEventListener("click", () => {
    window.location.href = "wallet.html";
  });

  mineBtn.addEventListener("click", async () => {
    const now = Date.now();
    if (now - userData.lastMine < MINE_INTERVAL) {
      alert("Please wait until the timer resets to mine again.");
      return;
    }
    const fixedAmount = 10;
    
    try {
      await runTransaction(db, async (t) => {
        const docSnap = await t.get(userDocRef);
        if (!docSnap.exists()) {
          throw "Document does not exist!";
        }
        const currentBalance = docSnap.data().balance || 0;
        const newBalance = currentBalance + fixedAmount;
        const newHistory = [...(docSnap.data().history || []), { amount: fixedAmount, time: now, type: 'mine' }];
        
        t.update(userDocRef, {
          balance: newBalance,
          lastMine: now,
          history: newHistory,
        });
      });
      userData.lastMine = now;
      userData.history.push({ amount: fixedAmount, time: now, type: 'mine' });
      renderHistory();
      await applyReferralCommission(fixedAmount);
      updateMiningTimer();
    } catch (error) {
      alert("Error updating balance: " + error.message);
    }
  });

  copyBtn.addEventListener("click", () => {
    refLink.select();
    refLink.setSelectionRange(0, 99999);
    document.execCommand("copy");
    alert("Referral link copied to clipboard!");
  });

  tabs.forEach(btn => {
    btn.addEventListener("click", () => {
      tabs.forEach(b => b.classList.remove("active"));
      tabContents.forEach(tc => tc.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById(btn.dataset.tab).classList.add("active");
    });
  });

  let gamePlayedToday = false;
  function canPlayGame() {
    const now = Date.now();
    return now - userData.lastGame > 24 * 60 * 60 * 1000;
  }

  boxes.forEach(box => {
    box.addEventListener("click", async () => {
      if (gamePlayedToday || !canPlayGame()) {
        gameResult.textContent = "You can only play once every 24 hours.";
        return;
      }
      if ((userData.referrals || 0) < minReferralCount) {
        gameResult.textContent = "Lucky box airdrop is disabled until you refer at least 10 users.";
        return;
      }
      
      gamePlayedToday = true;
      const prize = Math.floor(Math.random() * 50) + 1;
      gameResult.textContent = `You won ${prize} MDC!`;
      claimBtn.style.display = "inline-block";

      claimBtn.onclick = async () => {
        try {
          await runTransaction(db, async (t) => {
            const docSnap = await t.get(userDocRef);
            if (!docSnap.exists()) {
              throw "Document does not exist!";
            }
            const currentBalance = docSnap.data().balance || 0;
            const newBalance = currentBalance + prize;
            const newHistory = [...(docSnap.data().history || []), { amount: prize, time: Date.now(), type: 'luckyBox' }];

            t.update(userDocRef, {
              balance: newBalance,
              lastGame: Date.now(),
              history: newHistory
            });
          });
          gamePlayedToday = false;
          gameResult.textContent = "";
          claimBtn.style.display = "none";
        } catch (error) {
          alert("Error updating game reward: " + error.message);
        }
      };
    });
  });
</script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('service-worker.js')
      .then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
      }).catch(function(err) {
        console.log('ServiceWorker registration failed: ', err);
      });
    });
  }
</script>

</body>
</html>
